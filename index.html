<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-Day Fitness Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 1000px; /* A large value to handle varying content sizes */
            padding-bottom: 1rem;
            transition: max-height 0.5s ease-in, padding 0.5s ease-in;
        }
        .accordion-item:not(:last-child) {
            margin-bottom: 1rem;
        }
        .fun-animation {
            animation: pulse-check 0.3s ease-in-out;
        }
        @keyframes pulse-check {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 50;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ffcc00;
            opacity: 0;
            animation: confetti-fall 2s ease-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotateZ(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotateZ(720deg); opacity: 0; }
        }
        .workout-title {
            transition: color 0.3s ease-in-out;
        }
        .checkbox-container.completed .workout-title {
            color: #9ca3af;
            text-decoration: line-through;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 flex items-center justify-center min-h-screen p-4">
    <div id="app" class="w-full max-w-lg mx-auto bg-slate-800 rounded-2xl shadow-2xl overflow-hidden">
        <header class="bg-indigo-700 text-white p-6 text-center shadow-lg">
            <h1 class="text-3xl font-bold tracking-tight">6-Day Fitness Plan</h1>
            <p class="text-base font-light opacity-80 mt-1">Your Personalized Program</p>
        </header>
        <main id="workout-plan" class="p-6 space-y-4">
            <!-- Content will be injected here by JavaScript -->
        </main>
    </div>
    <div id="confetti-container" class="confetti-container hidden"></div>

    <script>
        const exercises = {
            push: [
                { title: 'Machine Chest Press', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=sEfN2Gebvag', tip: 'Press the handles forward, squeezing your chest at the peak of the movement.' },
                { title: 'Dumbbell Incline Press', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=xBj33JqHOPI', tip: 'Adjust the bench to a $30^\\circ$ to $45^\\circ$ incline. Lower the dumbbells slowly and press them up with control.' },
                { title: 'Machine Shoulder Press', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=e7YC-F-BH_o', tip: 'Keep your back pressed against the pad and avoid locking out your elbows at the top.' },
                { title: 'Dumbbell Lateral Raise', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=3VcKaXpzqRo', tip: 'Start with a light weight. Raise the dumbbells out to the side until your arms are parallel to the floor, leading with your elbows.' },
                { title: 'Triceps Pushdown (Cable Machine)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=yPohcZXCZSc', tip: 'Keep your elbows tucked in and focus on extending your arms using only your triceps.' },
                { title: 'Dumbbell Bench Press', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=VmB1G1K7v94', tip: 'Focus on a controlled descent and a powerful press.' },
                { title: 'Pec Deck Fly (Machine)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=LlaNWCX45rs', tip: 'Squeeze your chest muscles together as you bring your hands to the center.' },
                { title: 'Dumbbell Arnold Press', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=ASsEO6pabKk', tip: 'Rotate your hands as you press up, ending with palms facing forward.' },
                { title: 'Cable Front Raise', sets: '3 sets of 12-15 reps per arm', video: 'https://www.youtube.com/watch?v=KjqHI59JizY', tip: 'Use a slow and controlled motion, raising your arm to shoulder height.' },
                { title: 'Overhead Dumbbell Triceps Extension', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/shorts/wKEONiKiNCk', tip: 'Keep your elbows close to your head and focus on the stretch and contraction of the triceps.' }
            ],
            pull: [
                { title: 'Lat Pulldown (Machine)', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=71F5n4vzNVI', tip: 'Pull the bar down to your upper chest, squeezing your shoulder blades together.' },
                { title: 'Seated Cable Row', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=irxMQ2MtZrM', tip: 'Sit upright, keeping your back straight. Pull the handle towards your belly button, squeezing your back muscles.' },
                { title: 'Dumbbell Bent-Over Row', sets: '3 sets of 8-10 reps per arm', video: 'https://www.youtube.com/watch?v=Q--oAlwBsnI', tip: 'Use a bench for support. Keep your back flat and pull the dumbbell up to your side, driving your elbow toward the ceiling.' },
                { title: 'Dumbbell Bicep Curl', sets: '3 sets of 10-12 reps per arm', video: 'https://www.youtube.com/watch?v=ykJmrZ5v0Oo', tip: 'Curl the dumbbell up with a slow and controlled motion, squeezing your bicep at the top.' },
                { title: 'Machine Bicep Curl', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=JuMi9R9RHZ8', tip: 'A great finisher to isolate the bicep. Focus on a full range of motion.' },
                { title: 'Assisted Pull-Up Machine', sets: '3 sets of 8-10 reps', video: 'https://www.youtube.com/watch?v=ZgNenDsjYJo', tip: 'Use assistance to focus on form. Pull up until your chin is over the bar.' },
                { title: 'Dumbbell Single-Arm Row', sets: '3 sets: 12 reps, 10 reps, 8 reps per arm', video: 'https://www.youtube.com/watch?v=roCP6wCXPqo', tip: 'Keep your back flat and pull the dumbbell up to your side, driving your elbow toward the ceiling.' },
                { title: 'Straight-Arm Pulldown (Cable)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/shorts/JtYhF_ilm3o', tip: 'Focus on using your lats to pull the bar down, keeping your arms straight.' },
                { title: 'Dumbbell Hammer Curl', sets: '3 sets of 10-12 reps per arm', video: 'https://www.youtube.com/shorts/NyW2fT2gQhM', tip: 'Keep your palms facing each other and curl the weight up, focusing on the brachialis.' },
                { title: 'Reverse Grip Bicep Curl (Cable)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=8uQdYcCUOu8', tip: 'Use a reverse grip to target your forearms and brachialis along with your biceps.' }
            ],
            legs: [
                { title: 'Leg Press (Machine)', sets: '4 sets: 12 reps, 10 reps, 8 reps, 8 reps', video: 'https://www.youtube.com/watch?v=kuuabK2xhwY', tip: 'Place your feet shoulder-width apart. Lower the weight until your knees are at a $90^\\circ$ angle, then press back up without locking your knees.' },
                { title: 'Dumbbell Goblet Squat', sets: '3 sets: 12 reps, 10 reps, 8 reps', video: 'https://www.youtube.com/watch?v=Fd6nDkgAn0w', tip: 'Hold one heavy dumbbell vertically against your chest. Squat down as if sitting in a chair, keeping your chest up and back straight.' },
                { title: 'Leg Extension (Machine)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=W5AZCNTFpBk', tip: 'Focus on a strong squeeze at the top of the movement and a slow, controlled return.' },
                { title: 'Leg Curl (Machine)', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=YLJJJYOfSfc', tip: 'Curl your heels towards your glutes, feeling the contraction in your hamstrings.' },
                { title: 'Standing Calf Raise', sets: '4 sets of 15-20 reps', video: 'https://www.youtube.com/watch?v=_iYwv4QVFjM', tip: 'Go for a full stretch at the bottom and a powerful squeeze at the top.' },
                { title: 'Dumbbell Walking Lunges', sets: '3 sets of 10-12 reps per leg', video: 'https://www.dvidshub.net/video/549334/dumbbell-lunge', tip: 'Step forward and lower your hips until your back knee is just above the floor.' },
                { title: 'Machine Hip Adduction', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=7lLbDnC5Kq0', tip: 'Focus on squeezing your inner thighs together.' },
                { title: 'Machine Hip Abduction', sets: '3 sets of 12-15 reps', video: 'https://www.youtube.com/watch?v=DUC5VLQ_ABQ', tip: 'Push your knees outward against the pads, squeezing your glutes.' },
                { title: 'Seated Calf Raise (Machine)', sets: '4 sets of 15-20 reps', video: 'https://www.youtube.com/watch?v=pDkfpqOOA_M', tip: 'Keep your knees at a $90^\\circ$ angle and push through the balls of your feet.' },
                { title: 'Dumbbell Romanian Deadlift', sets: '3 sets of 10-12 reps', video: 'https://www.youtube.com/shorts/wqMYwk_-P14', tip: 'Keep your back straight and a slight bend in your knees. Hinge at your hips and feel the stretch in your hamstrings.' }
            ],
            core: [
                { title: 'Plank', sets: '3 sets, hold for 30-60 seconds', video: 'https://www.youtube.com/watch?v=3QZlgJ40LfU', tip: 'Keep your body in a straight line from head to heels.' },
                { title: 'BOSU Ball Crunch', sets: '3 sets of 15-20 reps', video: 'https://www.youtube.com/watch?v=KlE6VzIeLOg', tip: 'Place the BOSU ball under your lower back for a greater range of motion.' },
                { title: 'Russian Twist', sets: '3 sets of 20-30 reps (10-15 per side)', video: 'https://www.youtube.com/shorts/KUsvxlmpPoI', tip: 'Engage your core and rotate from your torso, not your arms.' },
                { title: 'Leg Raises', sets: '3 sets of 15-20 reps', video: 'https://www.youtube.com/shorts/fbGDQGHxvHk', tip: 'Keep your lower back pressed against the floor throughout the movement.' },
                { title: 'Side Plank', sets: '3 sets per side, hold for 30-45 seconds', video: 'https://www.youtube.com/watch?v=ribtncUfriU', tip: 'Keep your hips high and your body in a straight line.' },
                { title: 'BOSU Ball Plank', sets: '3 sets, hold for 30-60 seconds', video: 'https://au.physitrack.com/home-exercise-video/bosu-plank', tip: 'The unstable surface forces you to engage more stabilizer muscles.' },
                { title: 'BOSU Ball Mountain Climber', sets: '3 sets of 30-60 seconds', video: 'https://www.youtube.com/watch?v=NIQWRgEtK-s', tip: 'Place the BOSU ball flat-side down. Drive your knees towards your chest, alternating legs.' },
                { title: 'Flutter Kicks', sets: '3 sets of 30-60 seconds', video: 'https://www.youtube.com/watch?v=DhVSKD0M45c', tip: 'Keep your legs straight and make small, controlled movements.' },
                { title: 'BOSU Ball V-Up', sets: '3 sets of 10-15 reps', video: 'https://www.youtube.com/watch?v=J20KSNTY8FQ', tip: 'Balance on the BOSU ball and bring your knees and chest together in a V-shape.' },
                { title: 'Hollow Body Hold', sets: '3 sets, hold for 30-60 seconds', video: 'https://www.youtube.com/watch?v=01iEknlpnVY', tip: 'Keep your lower back pressed against the floor and your core engaged.' },
                { title: 'Hanging Leg Raises', sets: '3 sets of 10-15 reps', video: 'https://www.youtube.com/watch?v=chleWpBFCtg', tip: 'Raise your legs by engaging your core, not by swinging.' },
                { title: 'BOSU Ball Reverse Crunch', sets: '3 sets of 15-20 reps', video: 'https://www.youtube.com/watch?v=lnxjqAFdgLk', tip: 'Lie on the BOSU ball with your legs extended and use your lower abs to pull your knees in.' },
                { title: 'Standing Cable Wood Chop', sets: '3 sets of 10-12 reps per side', video: 'https://www.youtube.com/watch?v=H7y3hA-yJxE', tip: 'This is a powerful anti-rotation exercise. Keep your arms extended and drive the movement with your core and hips.' },
                { title: 'Dumbbell Farmers Walk', sets: '3 sets of 30-45 seconds', video: 'https://www.youtube.com/watch?v=R3LqFw0h0nI', tip: 'Hold a heavy dumbbell in each hand, stand tall, and walk with a steady pace. This is a full-body stability and grip exercise.' }
            ]
        };

        const generalGuidelinesMarkdown = `
# 6-Day Machine & Dumbbell Fitness Plan

Welcome to your personalized fitness program. This plan is designed for a 6-day training schedule, focusing primarily on the use of gym machines and free dumbbells, tailored to your body composition and goals. Our primary objective is to stimulate muscle hypertrophy (growth) while building a strong core and improving overall strength and stability.

### General Guidelines

* **Progressive Overload is Key:** The principle behind this plan is simple: consistently challenge your muscles. For the main lifts, you will follow a "pyramid" rep scheme, where you'll increase the weight as you decrease the repetitions with each set. This is a proven method for muscle gain.
* **Form First:** Given your body composition, maintaining impeccable form is non-negotiable to prevent injury and maximize muscle activation. Prioritize control over weight.
* **Warm-up:** Before each workout, perform 5-10 minutes of light cardio (treadmill, elliptical) to get your blood flowing. Follow with dynamic stretches targeting the muscles you'll be using.
* **Cool-down:** After each workout, perform 5-10 minutes of static stretching, holding each stretch for 20-30 seconds.
* **Rest:** Rest for 60-90 seconds between sets.
        `;

        const workoutPlanElement = document.getElementById('workout-plan');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createWorkoutPlan() {
            const startDate = new Date('2025-08-11T00:00:00');
            const today = new Date();
            const daysSinceStart = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const weekNumber = Math.floor(daysSinceStart / 7);

            // Seed random for consistent weekly shuffle
            const seed = weekNumber;
            Math.random = () => {
                const x = Math.sin(seed + new Date().getDay()) * 10000;
                return x - Math.floor(x);
            };
            
            const shuffledPush = shuffle([...exercises.push]);
            const shuffledPull = shuffle([...exercises.pull]);
            const shuffledLegs = shuffle([...exercises.legs]);
            const shuffledCore = shuffle([...exercises.core]);

            const weeklyPlan = [
                { type: 'push', exercises: shuffledPush.slice(0, 5) },
                { type: 'pull', exercises: shuffledPull.slice(0, 5) },
                { type: 'legs', exercises: shuffledLegs.slice(0, 5) },
                { type: 'push', exercises: shuffledPush.slice(5, 10) },
                { type: 'pull', exercises: shuffledPull.slice(5, 10) },
                { type: 'legs', exercises: shuffledLegs.slice(5, 10) },
                { type: 'rest', exercises: [] }
            ];

            const coreExercises = [
                { title: 'Core & Abs', exercises: shuffledCore.slice(0, 2) },
                { title: 'Core & Abs', exercises: shuffledCore.slice(2, 4) },
                { title: 'Core & Abs', exercises: shuffledCore.slice(4, 6) },
                { title: 'Core & Abs', exercises: shuffledCore.slice(6, 8) },
                { title: 'Core & Abs', exercises: shuffledCore.slice(8, 10) },
                { title: 'Core & Abs', exercises: shuffledCore.slice(10, 12) },
                { title: 'Core & Abs', exercises: [] }
            ];

            renderGeneralGuidelines(generalGuidelinesMarkdown);

            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const workoutOrder = [1, 2, 3, 4, 5, 6, 0]; // Mon, Tue, Wed, Thu, Fri, Sat, Sun

            for (let i = 0; i < 30; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const dateString = currentDate.toISOString().slice(0, 10);
                const dayIndex = currentDate.getDay();
                const dayName = dayNames[dayIndex];
                const weeklyPlanIndex = (daysSinceStart + i) % 7;
                const workoutForDay = weeklyPlan[workoutOrder[weeklyPlanIndex]];
                const coreForDay = coreExercises[workoutOrder[weeklyPlanIndex]];

                const isDayCompleted = localStorage.getItem(`dayCompleted_${dateString}`) === 'true';
                const savedNotes = localStorage.getItem(`notes_${dateString}`) || '';
                
                appendDayToDOM(currentDate, dayName, workoutForDay, coreForDay, dateString, isDayCompleted, savedNotes);
            }
            addListeners();
        }

        function renderGeneralGuidelines(markdown) {
            let html = `<div class="p-4 bg-slate-700 rounded-xl shadow-inner mb-4">`;
            const lines = markdown.split('\n');
            lines.forEach(line => {
                let trimmedLine = line.trim();
                if (trimmedLine.startsWith('#')) {
                    html += `<h2 class="text-2xl font-bold mb-2">${trimmedLine.replace('#', '').trim()}</h2>`;
                } else if (trimmedLine.startsWith('###')) {
                    html += `<h3 class="text-xl font-semibold mt-4 mb-2">${trimmedLine.replace('###', '').trim()}</h3>`;
                } else if (trimmedLine.startsWith('*')) {
                    const listItem = trimmedLine.replace('*', '').trim();
                    const boldedText = listItem.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    html += `<p class="mb-1 text-sm"><span class="text-indigo-400">&#x2022;</span> ${boldedText}</p>`;
                } else if (trimmedLine) {
                    html += `<p class="text-sm font-light leading-relaxed mb-2">${trimmedLine}</p>`;
                }
            });
            html += `</div>`;
            workoutPlanElement.innerHTML += html;
        }

        function appendDayToDOM(date, dayName, workoutForDay, coreForDay, dateString, isDayCompleted, savedNotes) {
            const dayContainer = document.createElement('div');
            dayContainer.className = 'accordion-item bg-slate-700 rounded-xl shadow-lg';
            dayContainer.setAttribute('data-date', dateString);

            const workoutTitle = workoutForDay.type !== 'rest' ? `${workoutForDay.type.charAt(0).toUpperCase() + workoutForDay.type.slice(1)}` : 'Rest Day';

            const headerHTML = `
                <div class="flex items-center space-x-4">
                    <input type="checkbox" id="day-checkbox-${dateString}" class="form-checkbox h-5 w-5 text-indigo-600 rounded" ${isDayCompleted ? 'checked' : ''} disabled>
                    <div>
                        <h2 class="text-lg md:text-xl font-bold">${dayName}, ${date.getMonth() + 1}/${date.getDate()}</h2>
                        <p class="text-sm font-light opacity-80">${workoutTitle}</p>
                    </div>
                </div>
                <span class="text-2xl transform transition-transform duration-200 text-indigo-400">+</span>
            `;

            const dayHeader = document.createElement('div');
            dayHeader.className = 'flex justify-between items-center p-4 cursor-pointer hover:bg-slate-600 rounded-xl transition-colors duration-200';
            dayHeader.innerHTML = headerHTML;

            const dayBody = document.createElement('div');
            dayBody.className = 'accordion-content px-4';

            const notesSection = `
                <div class="mt-4 mb-4">
                    <label for="notes-${dateString}" class="block text-sm font-medium mb-1">Workout Notes:</label>
                    <textarea id="notes-${dateString}" class="w-full h-20 p-2 text-sm bg-slate-900 border border-slate-600 rounded-md focus:ring focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your thoughts on today's workout...">${savedNotes}</textarea>
                </div>
            `;
            
            dayBody.innerHTML += notesSection;

            if (workoutForDay.type !== 'rest') {
                const workoutContent = convertExercisesToHtml(workoutForDay.exercises, dateString);
                dayBody.innerHTML += `
                    <div class="mt-4">
                        <h4 class="text-lg font-semibold">${workoutTitle} Exercises</h4>
                        ${workoutContent}
                    </div>
                `;

                if (coreForDay.exercises.length > 0) {
                    const coreContent = convertExercisesToHtml(coreForDay.exercises, dateString, true);
                     dayBody.innerHTML += `
                        <div class="mt-4">
                            <h4 class="text-lg font-semibold">${coreForDay.title}</h4>
                            ${coreContent}
                        </div>
                    `;
                }
            } else {
                dayBody.innerHTML += `<p class="mt-4 text-center text-lg font-semibold text-indigo-400">Enjoy your rest day!</p>`;
            }

            dayHeader.addEventListener('click', (e) => {
                const isOpen = dayBody.classList.contains('open');
                const allAccordionBodies = document.querySelectorAll('.accordion-content');
                const allAccordionIcons = document.querySelectorAll('.accordion-item span');

                allAccordionBodies.forEach(body => {
                    body.classList.remove('open');
                    body.style.maxHeight = null;
                });
                allAccordionIcons.forEach(icon => {
                    icon.style.transform = 'rotate(0deg)';
                });

                if (!isOpen) {
                    dayBody.classList.add('open');
                    dayBody.style.maxHeight = dayBody.scrollHeight + 'px';
                    const icon = dayHeader.querySelector('span');
                    icon.style.transform = 'rotate(45deg)';
                }
            });

            dayContainer.appendChild(dayHeader);
            dayContainer.appendChild(dayBody);
            workoutPlanElement.appendChild(dayContainer);
        }

        function convertExercisesToHtml(exerciseList, dateString, isCore = false) {
            let html = '';
            let exerciseIndex = 0;
            exerciseList.forEach(exercise => {
                const workoutId = `${dateString}-${isCore ? 'core-' : ''}${exerciseIndex++}`;
                const isCompleted = localStorage.getItem(`workoutCompleted_${workoutId}`) === 'true';
                
                const title = exercise.title.replace(/(\d+ reps|\d+ sets)/g, '<strong>$1</strong>');
                const sets = exercise.sets.replace(/(\d+ reps|\d+ sets)/g, '<strong>$1</strong>');
                const tip = exercise.tip;
                const videoUrl = exercise.video;
                
                html += `<div class="flex items-start pl-2 pb-2 text-sm checkbox-container ${isCompleted ? 'completed' : ''}" data-workout-id="${workoutId}">
                    <input type="checkbox" id="workout-checkbox-${workoutId}" class="form-checkbox h-4 w-4 mt-1 text-indigo-600 rounded" ${isCompleted ? 'checked' : ''}>
                    <div class="ml-2 flex-grow">
                        <label for="workout-checkbox-${workoutId}" class="workout-title block cursor-pointer">
                            <span class="text-white">&#x2022;</span> <strong>${title}</strong>: ${sets}
                        </label>`;
                
                if (videoUrl) {
                    html += `<a href="${videoUrl}" target="_blank" class="text-indigo-400 hover:underline text-xs ml-4">Watch Video</a>`;
                }

                if (tip) {
                    html += `<p class="text-slate-400 text-xs italic mt-1 ml-4">Tip: ${tip}</p>`;
                }
                
                html += `</div></div>`;
            });
            return html;
        }


        function addListeners() {
            workoutPlanElement.addEventListener('change', (e) => {
                if (e.target.type === 'checkbox' && e.target.id.startsWith('workout-checkbox-')) {
                    const checkbox = e.target;
                    const workoutId = checkbox.closest('.checkbox-container').dataset.workoutId;
                    const dateString = workoutId.split('-').slice(0, 3).join('-');
                    const dayContainer = checkbox.closest('.accordion-item');
                    
                    localStorage.setItem(`workoutCompleted_${workoutId}`, checkbox.checked);

                    checkbox.closest('.checkbox-container').classList.add('fun-animation');
                    setTimeout(() => checkbox.closest('.checkbox-container').classList.remove('fun-animation'), 300);

                    if (checkbox.checked) {
                        checkbox.closest('.checkbox-container').classList.add('completed');
                    } else {
                        checkbox.closest('.checkbox-container').classList.remove('completed');
                    }

                    checkDayCompletion(dayContainer, dateString);
                }
            });

            workoutPlanElement.addEventListener('input', (e) => {
                if (e.target.tagName === 'TEXTAREA') {
                    const dateString = e.target.id.split('-').slice(1).join('-');
                    localStorage.setItem(`notes_${dateString}`, e.target.value);
                }
            });
        }
        
        function checkDayCompletion(dayContainer, dateString) {
            const allWorkouts = dayContainer.querySelectorAll('input[type="checkbox"][id^="workout-checkbox-"]');
            if (allWorkouts.length === 0) {
                 const dayCheckbox = dayContainer.querySelector(`#day-checkbox-${dateString}`);
                 dayCheckbox.checked = true;
                 localStorage.setItem(`dayCompleted_${dateString}`, true);
                 playConfetti();
                 return;
            }
            
            let allCompleted = true;
            allWorkouts.forEach(checkbox => {
                if (!checkbox.checked) {
                    allCompleted = false;
                }
            });

            const dayCheckbox = dayContainer.querySelector(`#day-checkbox-${dateString}`);
            if (dayCheckbox) {
                dayCheckbox.checked = allCompleted;
                localStorage.setItem(`dayCompleted_${dateString}`, allCompleted);
            }

            if (allCompleted) {
                playConfetti();
            }
        }
        
        function playConfetti() {
            const confettiContainer = document.getElementById('confetti-container');
            confettiContainer.classList.remove('hidden');
            const confettiColors = ['#ffcc00', '#ff6f61', '#5d40ff', '#4caf50', '#00bcd4', '#ff8a65'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(confetti);
            }
            setTimeout(() => {
                confettiContainer.classList.add('hidden');
                confettiContainer.innerHTML = '';
            }, 2000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            createWorkoutPlan();
            document.querySelectorAll('.accordion-item').forEach(dayContainer => {
                const dateString = dayContainer.dataset.date;
                checkDayCompletion(dayContainer, dateString);
            });
        });
    </script>
</body>
</html>
